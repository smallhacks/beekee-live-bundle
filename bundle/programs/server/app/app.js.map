{"version":3,"sources":["meteor://ðŸ’»app/lib/app_loader.js","meteor://ðŸ’»app/imports/api/activities.js","meteor://ðŸ’»app/imports/api/assignments.js","meteor://ðŸ’»app/imports/api/authors.js","meteor://ðŸ’»app/imports/api/categories.js","meteor://ðŸ’»app/imports/api/chats.js","meteor://ðŸ’»app/imports/api/codes.js","meteor://ðŸ’»app/imports/api/files.js","meteor://ðŸ’»app/imports/api/notifications.js","meteor://ðŸ’»app/imports/api/posts.js","meteor://ðŸ’»app/imports/api/resources.js","meteor://ðŸ’»app/imports/api/spaces.js","meteor://ðŸ’»app/imports/api/users.js","meteor://ðŸ’»app/server/fixtures.js","meteor://ðŸ’»app/server/methods.js","meteor://ðŸ’»app/server/permissions.js","meteor://ðŸ’»app/server/uploads.js","meteor://ðŸ’»app/server/main.js"],"names":["Meteor","isServer","Inject","rawHead","rawBody","Assets","getText","isClient","startup","setTimeout","$","fadeOut","remove","module","export","Activities","Mongo","link","v","Categories","Collection","allow","insert","update","publish","activityId","check","String","find","_id","filters","sort","submitted","after","userId","doc","categoryId","category","findOne","$inc","nRefs","methods","activityInsert","activityAttributes","spaceId","activity","_","extend","Date","now","order","count","space","Assignments","assignmentId","assignmentInsert","assignmentAttributes","assignment","type","assignmentWorkInsert","assignmentWork","Authors","Posts","authorInsert","name","color","user","profile","avatar","error","console","log","message","colors","colorPicked","Math","floor","random","length","avatars","avatarPicked","authorEdit","oldName","newName","author","$set","multi","authorDelete","createPasswords","allAuthors","fetch","i","password","makeCode","text","possible","charAt","Resources","subcategoryId","$gt","categoryInsert","instruction","categoryEdit","id","oldSubcategoryId","newSubcategoryId","nbNewCategories","categoryDelete","Chats","Spaces","Files","$or","sender","receiver","markChatMessagesSeen","otherUser","$and","isSeen","Codes","fileId","fs","Npm","require","rimraf","uploadDir","settings","deleteFile","post","err","unlinkSync","filePath","Notifications","postId","mailCommentNotification","spaceOwner","users","ownerMail","emails","address","lastComment","comments","mailBody","TAPi18n","__","body","defer","call","deletePostNotifications","elementId","resourceId","clearAllNotifications","Counts","PinnedCounts","FilesCounts","ImagesCounts","LiveFeedCounts","ResourcesCounts","FeedCounts","sorting","skip","limit","self","liveFeedCounts","initializing","handle","observeChanges","added","idx","changed","removed","ready","onStop","stop","resourcesCounts","fileExt","taggedAuthors","match","taggedAuthor","replace","mailPostNotification","addLikeComment","data","currentPostId","currentCommentId","$push","removeLikeComment","$pull","addResourceLikeComment","removeResourceLikeComment","homePostInsert","postAttributes","postInsert","item","authorId","nb","likes","nbLikes","clientIP","connection","clientAddress","resourceInsert","resourceAttributes","resource","ownsDocument","isAdmin","ownersId","$in","spacesId","before","getSpaceId","spaceCode","updateCode","oldCode","newCode","codeId","code","changeOwner","newUserId","addOwner","newUserMail","newUser","$addToSet","deleteSpace","deleteSpaces","duplicateSpace","originSpaceId","duplicaName","lang","prefix","public","codeLength","spaceToCopy","title","visible","codePanel","createUserAllowed","liveFeed","lessons","resources","liveFeedComments","permissions","authorList","liveFeedAddPost","liveFeedAddPostHome","liveFeedAddCategory","liveFeedChangeName","addResourcesAllowed","passwordNeeded","avatarEnabled","spaceDir","existsSync","mkdirSync","forEach","newFilePath","fileName","copyFile","newCategoryId","url","youtubeid","vimeoid","spaceInsert","spaceAttributes","Roles","userIsInRole","roleAssignment","spaceOwners","email","oldemail","emailReg","test","Accounts","removeEmail","addEmail","createRole","unlessExists","adminPassword","username","roles","each","createUser","addUsersToRoles","process","env","MAIL_URL","mailAddress","mailPassword","mailServer","emailTemplates","from","resetPassword","subject","urls","token","exec","cmd","wrapAsync","sendEmail","to","unblock","Email","send","html","adminId","newPassword","setPassword","result","res","premium","indexOf","rotateImage","imagePath","gmRotate","callback","gm","rotate","write","bindEnvironment","syncFunc","UploadServer","init","tmpDir","checkCreateDirectories","maxFileSize","getDirectory","fileInfo","formData","newID","ObjectID","_str","finished","formFields","substr","lastIndexOf","toLowerCase","path","autoOrient","resize","errorMessage","maxBuffer","res2","updateDir","getFileName","cacheTime"],"mappings":"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","file":"/app.js","sourcesContent":["if (Meteor.isServer) {\n\tInject.rawHead(\"metaLoader\", '<meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=0, width=device-width, height=device-height\"/><meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\t<meta name=\"mobile-web-app-capable\" content=\"yes\">');\n\n\tInject.rawBody(\"htmlLoader\", Assets.getText('app_loader.html'));\n}\n\nif (Meteor.isClient) {\n\tMeteor.startup(function() {\n\t\tsetTimeout(function() {\n\t\t\t$(\"#inject-loader-wrapper\").fadeOut(500, function() { $(this).remove(); });\n\t\t}, 700);\n\t});\n}","import { Mongo } from 'meteor/mongo';\n \n// import { Authors } from './authors.js';\n// import { Spaces } from './spaces.js';\nimport { Categories } from './categories.js';\n// import { Files } from './files.js';\n//import { Notifications } from './notifications.js';\n\nexport const Activities = new Mongo.Collection('activities');\n\n\nActivities.allow({\n\tinsert: function() {return true;},\n\n\tremove: function() {return true;},\n\n\tupdate: function() {return true;}\n});\n\n\nif(Meteor.isServer) {\n\n\tMeteor.publish('activity', function(activityId) {\n\t\tcheck(activityId, String);\n\t\treturn Activities.find({_id: activityId});\n\t});\n\n\tMeteor.publish('activities', function(filters) {\n\t\t//return Activities.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\treturn Activities.find(filters, {sort: {submitted:1}});\n\t});\n\n\tMeteor.publish('allActivities', function(filters) {\n\t\t//return Activities.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\treturn Activities.find(filters, {sort: {submitted:1}});\n\t});\n\n\tActivities.after.remove(function (userId, doc) { \n\t\tif (doc.categoryId) {\n\t\t\tvar category = Categories.findOne({_id:doc.categoryId});\n\t\t\tif (category)\n\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}});\n\t\t}\n\t});\n}\n\n\nMeteor.methods({\n\n\tactivityInsert: function(activityAttributes) {\n\t\tcheck(activityAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\tactivity = _.extend(activityAttributes, {\n\t\t\tsubmitted: Date.now(),\n\t\t\torder: Activities.find({spaceId: activityAttributes.spaceId, categoryId: activityAttributes.categoryId}).count(),\n\t\t});\n\n\t\tcategory = Categories.findOne({spaceId: activityAttributes.spaceId, _id: activityAttributes.categoryId}); // Increment category nRefs\n\t\tCategories.update(category, {$inc: {nRefs: 1}});\n\n\t\tvar space = Activities.findOne(activityAttributes.spaceId);\n\t\tactivity._id = Activities.insert(activity);\t\t\n\t\treturn activity._id;\n\t}\n});","import { Mongo } from 'meteor/mongo';\n \n// import { Authors } from './authors.js';\n// import { Spaces } from './spaces.js';\nimport { Categories } from './categories.js';\n// import { Files } from './files.js';\n//import { Notifications } from './notifications.js';\n\nexport const Assignments = new Mongo.Collection('assignments');\n\n\nAssignments.allow({\n\tinsert: function() {return true;},\n\n\tremove: function() {return true;},\n\n\tupdate: function() {return true;}\n});\n\n\nif(Meteor.isServer) {\n\n\tMeteor.publish('assignment', function(assignmentId) {\n\t\tcheck(activityId, String);\n\t\treturn Assignments.find({_id: activityId});\n\t});\n\n\tMeteor.publish('assignments', function(filters) {\n\t\t//return Activities.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\treturn Assignments.find(filters, {sort: {submitted:1}});\n\t});\n\n\tMeteor.publish('allAssignments', function(filters) {\n\t\t//return Activities.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\treturn Assignments.find(filters, {sort: {submitted:1}});\n\t});\n\n\tAssignments.after.remove(function (userId, doc) { \n\t\tif (doc.categoryId) {\n\t\t\tvar category = Categories.findOne({_id:doc.categoryId});\n\t\t\tif (category)\n\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}});\n\t\t}\n\t});\n}\n\n\nMeteor.methods({\n\n\tassignmentInsert: function(assignmentAttributes) {\n\t\tcheck(assignmentAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\tassignment = _.extend(assignmentAttributes, {\n\t\t\tsubmitted: Date.now(),\n\t\t\ttype: \"assignment\",\n\t\t\torder: Assignments.find({spaceId: assignmentAttributes.spaceId, categoryId: assignmentAttributes.categoryId}).count(),\n\t\t});\n\n\t\tcategory = Categories.findOne({spaceId: assignmentAttributes.spaceId, _id: assignmentAttributes.categoryId}); // Increment category nRefs\n\t\tCategories.update(category, {$inc: {nRefs: 1}});\n\n\t\tvar space = Assignments.findOne(assignmentAttributes.spaceId);\n\t\tassignment._id = Assignments.insert(assignment);\t\t\n\t\treturn assignment._id;\n\t},\n\tassignmentWorkInsert: function(assignmentAttributes) {\n\t\tcheck(assignmentAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\tassignmentWork = _.extend(assignmentAttributes, {\n\t\t\tsubmitted: Date.now(),\n\t\t\ttype: \"assignmentWork\"\n\t\t});\n\n\t\tvar space = Assignments.findOne(assignmentAttributes.spaceId);\n\t\tassignmentWork._id = Assignments.insert(assignmentWork);\t\t\n\t\treturn assignmentWork._id;\n\t}\n});","import { Mongo } from 'meteor/mongo';\n\nimport { Posts } from './posts.js';\n \nexport const Authors = new Mongo.Collection('authors');\n\nAuthors.allow({\n\n\tinsert: function() {return true},\n\n\tremove: function() {return true},\n\n\tupdate: function() {return true}\n});\n\nif(Meteor.isServer) {\n\n\tMeteor.publish(\"authors\", function(spaceId) {\n\t\treturn Authors.find({spaceId: spaceId});\n\t});\n}\n\nMeteor.methods({\n\n\tauthorInsert: function(name, spaceId, userId=false) {\n\t\tif (userId) {\n\t\t\tAuthors.insert({name: name, spaceId: spaceId, userId: userId, color: Meteor.user().profile.color, avatar:Meteor.user().profile.avatar, nRefs: 0},function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(\"Error when inserting author  : \"+error.message);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Author inserted\");\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tcolors = [\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\",\"27a498\",\"25c0d4\",\"27b0ee\",\"41a1ef\",\"5a66ba\",\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\"];\n\t\t\tvar colorPicked = \"#\"+colors[Math.floor(Math.random() * colors.length)];\n\n\t\t\tavatars = [\"avatar-1\", \"avatar-2\",\"avatar-3\", \"avatar-4\",\"avatar-5\", \"avatar-6\",\"avatar-7\", \"avatar-8\",\"avatar-9\", \"avatar-10\",\"avatar-11\", \"avatar-12\",\"avatar-13\", \"avatar-14\",\"avatar-15\", \"avatar-16\",\"avatar-17\", \"avatar-18\",\"avatar-19\", \"avatar-20\",\"avatar-21\", \"avatar-22\",\"avatar-23\", \"avatar-24\", \"avatar-25\"];\n\t\t\tvar avatarPicked = avatars[Math.floor(Math.random() * avatars.length)];\n\n\t\t\tAuthors.insert({name: name, spaceId: spaceId, userId: userId, color: colorPicked, avatar:avatarPicked, nRefs: 0},function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(\"Error when inserting author  : \"+error.message);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Author inserted B\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tauthorEdit: function(spaceId, oldName, newName) {\n\t\tvar author = Authors.findOne({name: oldName, spaceId: spaceId});\n\t\tAuthors.update(author._id, {$set: {name:newName}}, function(error) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when changing author name : \"+error.message);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tPosts.update({spaceId:spaceId, author: oldName},{$set: {author: newName}}, {multi: true}); // Update all author posts with new name\n\t\t\t}\n\t\t});\n\t},\n\tauthorDelete: function(name, spaceId) {\n\t\tAuthors.remove({name: name, spaceId: spaceId},function(error) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when removing author  : \"+error.message);\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Author removed\");\n\t\t\t}\n\t\t});\n\t},\n\tcreatePasswords: function(spaceId) {\n\t\tvar allAuthors = Authors.find({spaceId:spaceId}).fetch();\n\n\t\tfor (var i=0; i< allAuthors.length ; i++) {\n\t\t\t// Set a random password for students who don't have aleady one set\n\t\t\tAuthors.update({_id:allAuthors[i]._id, password:null},{$set:{password:makeCode(4)}});\n\t\t}\n\t}\n});\n\nfunction makeCode(length)\n{\n\tvar text = \"\";\n\tvar possible = \"0123456789\"\n\n\tfor( var i=0; i < length; i++ )\n\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\t\n\treturn text;\n}","import { Mongo } from 'meteor/mongo';\n \nimport { Posts } from './posts.js';\nimport { Activities } from './activities.js';\nimport { Resources } from './resources.js';\n\n\nexport const Categories = new Mongo.Collection('categories');\n\nCategories.allow({\n\n\tinsert: function() {return true},\n\n\tremove: function() {return true},\n\n\tupdate: function() {return true}\n});\n\n\nif(Meteor.isServer) {\n\n\tMeteor.publish(\"categories\", function(spaceId) {\n\t\treturn Categories.find({spaceId: spaceId});\n\t});\n\n\n\tCategories.after.update(function (userId, doc) {\n\n\n\t});\n\n\n\n\tCategories.after.remove(function (userId, doc) {\n\n\t\t// Decrease order number of others categories\n\t\tif (!doc.subcategoryId)\n\t\t\tCategories.update({spaceId: doc.spaceId, order: { $gt: doc.order } },{$inc: { order: -1 }},{multi:true});\n\t\telse\n\t\t\tCategories.update({spaceId: doc.spaceId, subcategoryId: doc.subcategoryId, order: { $gt: doc.order } },{$inc: { order: -1 }},{multi:true});\n\t\n\t\t\n\t\t// Remove reference to the category in posts, activities and resources\n\t\tPosts.update({categoryId:doc._id},{$set:{categoryId:null}},{multi:true});\n\t\tActivities.update({categoryId:doc._id},{$set:{categoryId:null}},{multi:true});\n\t\tResources.update({categoryId:doc._id},{$set:{categoryId:null}},{multi:true});\n\t});\n}\n\nMeteor.methods({\n\n\tcategoryInsert: function(type, name, spaceId, subcategoryId = \"\") {\n\t\tcolors= [\"color-1\", \"color-2\", \"color-3\", \"color-4\", \"color-5\", \"color-6\", \"color-7\", \"color-8\"];\n\t\t//colors = [\"cdfe96\",\"afccf8\",\"e5c9aa\",\"fabb2d\",\"fff37e\",\"fcd0e8\",\"d7b0f9\"]\n\t\t//colors = [\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\",\"27a498\",\"25c0d4\",\"27b0ee\",\"41a1ef\",\"5a66ba\",\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\"];\n\t\tvar colorPicked = colors[Math.floor(Math.random() * colors.length)];\n\n\t\tvar order = null;\n\t\tif (subcategoryId != \"\")\n\t\t\torder = Categories.find({spaceId: spaceId, subcategoryId:subcategoryId}).count();\n\t\telse\n\t\t\torder = Categories.find({spaceId: spaceId, subcategoryId:null}).count();\n\n\n\t\treturn Categories.insert({\n\t\t\ttype: type,\n\t\t\tname: name, \n\t\t\tcolor:colorPicked,\n\t\t\tsubcategoryId:subcategoryId,\n\t\t\tinstruction:\"\",\n\t\t\tspaceId: spaceId,\n\t\t\tnRefs: 0,\n\t\t\torder: order\n\t\t});\n\t},\n\tcategoryEdit: function(spaceId, type, id, newName, oldSubcategoryId = \"\", newSubcategoryId = \"\") {\n\t\tvar category = Categories.findOne({_id:id});\n\t\tCategories.update(category._id, {$set: {name:newName, subcategoryId:newSubcategoryId}}, function(error) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when changing category name : \"+error.message);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Re-calculate order if category change\n\t\t\t\tif (oldSubcategoryId != newSubcategoryId) {\n\t\t\t\t\tconsole.log(\"on change ici \");\n\t\t\t\t\tCategories.update({subcategoryId: oldSubcategoryId, order: { $gt: category.order } },{$inc: { order: -1 }},{multi:true}); // Decrease all subcategories order if higher than the category's order\n\t\t\t\t\tvar nbNewCategories = Categories.find({spaceId: spaceId, subcategoryId: newSubcategoryId}).count();\n\t\t\t\t\tconsole.log(\"nbNewCategories : \"+nbNewCategories);\n\t\t\t\t\tCategories.update(category._id, {$set: { order: nbNewCategories-1 }});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tcategoryDelete: function(id, spaceId) {\n\t\tvar category = Categories.findOne({_id:id});\n\t\tCategories.remove(category._id, function(error) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when deleting category : \"+error.message);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Delete subcategories\n\t\t\t\tCategories.remove({subcategoryId:category._id});\t\t\t\n\t\t\t}\n\t\t});\n\t}\n});","import { Mongo } from 'meteor/mongo';\n \nimport { Authors } from './authors.js';\nimport { Spaces } from './spaces.js';\nimport { Categories } from './categories.js';\nimport { Files } from './files.js';\n//import { Notifications } from './notifications.js';\n\nexport const Chats = new Mongo.Collection('chats');\n\n\nChats.allow({\n\tinsert: function() {return true;},\n\n\tremove: function() {return true;},\n\n\tupdate: function() {return true;}\n});\n\nif(Meteor.isServer) {\n\n\tMeteor.publish('ownChats', function(spaceId, userId) { // get all chats from a specific spaceId where the user is in\n\treturn Chats.find({spaceId:spaceId, $or:[{sender:userId},{receiver:userId}]});\n});\n\n// Meteor.publish('ownChats', function(spaceId, userId) { // get all chats from a specific spaceId where the user is in\n// \treturn Chats.find({spaceId:spaceId, $or:[{sender:userId},{receiver:userId}]});\n// });\n\n\n\n\n}\n\n\nMeteor.methods({\n\n\tmarkChatMessagesSeen: function(user, otherUser) {\n\t\tChats.update({$and:[{sender:otherUser},{receiver:user}]},{$set:{isSeen:Date.now()}}, {multi: true});\n\t}\n});","import { Mongo } from 'meteor/mongo';\n \nexport const Codes = new Mongo.Collection('codes');\n\nCodes.allow({\n\n\tinsert: function() {return true},\n\n\tremove: function() {return true},\n\n\tupdate: function() {return true}\n});","import { Mongo } from 'meteor/mongo';\n \nexport const Files = new Mongo.Collection('files');\n\n\nFiles.allow({\n\n  \tinsert: function() {return true},\n\n \tremove: function() {return true},\n\n\tupdate: function() {return true}\n});\n\nif(Meteor.isServer) {\n\n\tMeteor.publish(\"file\", function(fileId) {\n\treturn Files.find({_id:fileId})\n});\n\nMeteor.publish(\"files\", function(spaceId) {\n\treturn Files.find({spaceId: spaceId})\n});\n\nMeteor.publish(\"allFiles\", function() {\n\treturn Files.find({})\n});\n\n\tvar fs = Npm.require('fs');\n\tvar rimraf = Npm.require('rimraf'); // Package to delete directories\n\tvar uploadDir = Meteor.settings.uploadDir;\n\n\tMeteor.methods({\n\n\t\tdeleteFile: function(post) {\n\n\t\t\tif (post.type == 'lesson') // Remove directory (each storline lesson is stored in is own directory)\n\t\t\t\trimraf(uploadDir+\"/\"+post.spaceId+\"/\"+post.type+\"/\"+post.fileId, function (err) {console.log(err)});\n\t\t\telse // Remove the file\n    \t\t\tfs.unlinkSync(uploadDir +\"/\"+post.filePath, function (err) {console.log(err)});\n  \t\t}\n\t})\n}","import { Mongo } from 'meteor/mongo';\nimport { Spaces } from './spaces.js';\nimport { Posts } from './posts.js';\n\nexport const Notifications = new Mongo.Collection('notifications');\n\nNotifications.allow({\n\n\tinsert: function() {return true},\n\n\tremove: function() {return true},\n\n\tupdate: function() {return true}\n});\n\nif(Meteor.isServer) {\n\n\tMeteor.publish(\"notifications\", function(spaceId) {\n\t\treturn Notifications.find({spaceId: spaceId});\n\t});\n\n\tNotifications.after.insert(function (userId, doc) { \n\n\t\tvar space = Spaces.findOne(doc.spaceId);\n\t\tvar post = Posts.findOne(doc.postId);\n\n\t\tif (space.mailCommentNotification == true) {\n\n\t\t\tconsole.log(\"userId : \"+userId);\n\n\t\t\tif (space.userId != Meteor.userId()) {\n\n\t\t\tvar spaceOwner = Meteor.users.findOne({_id:space.userId});\n\n\t\t\tconsole.log(\"space Id : \"+spaceOwner);\n\n\t\t\tvar ownerMail = spaceOwner.emails[0].address;\n\n\t\t\tvar lastComment = post.comments[post.comments.length-1];\n\t\t\tconsole.log(\"last comment : \"+post.comments.length);\n\n\t\t\tconsole.log(\"on envoie un e-mail de notification Ã  :\"+ownerMail);\n\t\t\tvar mailBody = null;\n\t\t\tif (post.filePath) {\n\t\t        mailBody = '<h3>'+TAPi18n.__(\"post-submit--mail-comment-notification-body\")+'</h3><p><b>'+lastComment.author+'</b></p><p>'+lastComment.text+'</p><p>----------</p><div style=\"padding:8px:border:solid 1px grey;\"><p><b>'+post.author+'</b></p><p>'+post.body+'</p><img style=\"width:150px\" src=\"https://live2.beekee.ch/upload'+post.filePath+'\" /></div><a href=\"https://live2.beekee.ch/post/'+post._id+'\">'+TAPi18n.__(\"post-submit--mail-notification-link\")+'</a>'\n\n\t\t\t} else {\n\t\t        mailBody = '<h3>'+TAPi18n.__(\"post-submit--mail-comment-notification-body\")+'</h3><p><b>'+lastComment.author+'</b></p><p>'+lastComment.text+'</p><p>----------</p><div style=\"padding:8px:border:solid 1px grey;\"><p><b>'+post.author+'</b></p><p>'+post.body+'</p></div><a href=\"https://live2.beekee.ch/post/'+post._id+'\">'+TAPi18n.__(\"post-submit--mail-notification-link\")+'</a>'\n\t\t\t}\n\n\t\t\tMeteor.defer(function() { // Avoid client to wait for callback\n\t\t\t\tMeteor.call('sendEmail', // Send an e-mail to user\n\t\t            ownerMail,\n\t\t            'info@beekee.ch',\n\t\t            TAPi18n.__(\"post-submit--mail-comment-notification-subject\"),\n\t\t            mailBody\n\t\t        );\t\n\t\t\t});\n\t       }\n\t     }\n\t});\n\n}\n\nMeteor.methods({\n\n\tdeletePostNotifications: function(spaceId, author, elementId) {\n\t\tconsole.log(\"spaceID : \"+spaceId+\" author: \"+author+\" elementID : \"+elementId);\n\t\tNotifications.remove({spaceId: spaceId, receiver:author, postId:elementId});\n\t\tNotifications.remove({spaceId: spaceId, receiver:author, resourceId:elementId});\n\n\t\t//Posts.update({_id:data.currentPostId,\"comments.id\":data.currentCommentId}, {$push: {\"comments.$.likes\": data.author}});\n\t},\n\tclearAllNotifications: function(spaceId, author) {\n\t\tNotifications.remove({spaceId: spaceId, receiver:author});\n\t}\n});","import { Mongo } from 'meteor/mongo';\n \nimport { Authors } from './authors.js';\nimport { Spaces } from './spaces.js';\nimport { Categories } from './categories.js';\nimport { Files } from './files.js';\nimport { Resources } from './resources.js';\nimport { Notifications } from './notifications.js';\n\nexport const Posts = new Mongo.Collection('posts');\n\n\nPosts.allow({\n\tinsert: function() {return true;},\n\n\tremove: function() {return true;},\n\n\tupdate: function() {return true;}\n});\n\nif(Meteor.isClient) {\n\tCounts = new Mongo.Collection(\"counts\"); // Store post count of a space ; Allow to count them without subscribe to all posts (optimization)\n\tPinnedCounts = new Mongo.Collection(\"pinnedCounts\");\n\tFilesCounts = new Mongo.Collection(\"filesCounts\");\n\tImagesCounts = new Mongo.Collection(\"imagesCounts\");\n\tLiveFeedCounts = new Mongo.Collection(\"liveFeedCounts\");\n\tResourcesCounts = new Mongo.Collection(\"resourcesCounts\");\n\tFeedCounts = new Mongo.Collection(\"feedCounts\");\n}\n\nif(Meteor.isServer) {\n\nMeteor.publish('post', function(postId) {\n\tcheck(postId, String);\n\treturn Posts.find({_id: postId});\n});\n\nMeteor.publish('homePosts', function(spaceId) {\n\tcheck(spaceId, String);\n\treturn Posts.find({spaceId: spaceId, type:\"home\"},{sort: {submitted: 1}});\n});\n\nMeteor.publish('liveFeedPosts', function(spaceId) {\n\tcheck(spaceId, String);\n\treturn Posts.find({spaceId: spaceId, type:\"liveFeed\"},{sort: {submitted: -1}});\n});\n\nMeteor.publish('resourcesPosts', function(spaceId) {\n\tcheck(spaceId, String);\n\treturn Posts.find({spaceId: spaceId, type:\"resource\"});\n});\n\nMeteor.publish('posts', function(sorting, filters, skip = 0, limit = 0) {\n\treturn Posts.find(filters, {sort: {submitted:-1},skip:skip,limit:limit});\n\t//return Posts.find(filters, {sort: {submitted:1},skip:skip,limit:limit});\n});\n\nMeteor.publish('lastPosts', function() {\n\treturn Posts.find({},{sort: {submitted:-1}, limit: 20});\n});\n\n// Meteor.publish(\"count-all-feed\", function (spaceId) {\n// \tvar self = this;\n// \tvar feedCounts = 0;\n// \tvar initializing = true;\n\n// \tvar handle = Posts.find({spaceId: spaceId, type:'liveFeed'}).observeChanges({\n// \t\tadded: function (doc, idx) {\n// \t\t\tliveFeedCounts++;\n// \t\t\tif (!initializing) {\n// \t\t\t\tself.changed(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});  // \"counts\" is the published collection name\n// \t\t\t}\n// \t\t},\n// \t\tremoved: function (doc, idx) {\n// \t\t\tliveFeedCounts--;\n// \t\t\tself.changed(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});  // Same published collection, \"counts\"\n// \t\t}\n// \t});\n\n// \tinitializing = false;\n\n// \t// publish the initial count. `observeChanges` guaranteed not to return\n// \t// until the initial set of `added` callbacks have run, so the `count`\n// \t// variable is up to date.\n// \tself.added(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});\n\n// \t// and signal that the initial document set is now available on the client\n// \tself.ready();\n\n// \t// turn off observe when client unsubscribes\n// \tself.onStop(function () {\n// \t\thandle.stop();\n// \t});\n// });\n\nMeteor.publish(\"count-all-live-feed\", function (spaceId) {\n\tvar self = this;\n\tvar liveFeedCounts = 0;\n\tvar initializing = true;\n\n\tvar handle = Posts.find({spaceId: spaceId, type:'liveFeed'}).observeChanges({\n\t\tadded: function (doc, idx) {\n\t\t\tliveFeedCounts++;\n\t\t\tif (!initializing) {\n\t\t\t\tself.changed(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});  // \"counts\" is the published collection name\n\t\t\t}\n\t\t},\n\t\tremoved: function (doc, idx) {\n\t\t\tliveFeedCounts--;\n\t\t\tself.changed(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});  // Same published collection, \"counts\"\n\t\t}\n\t});\n\n\tinitializing = false;\n\n\t// publish the initial count. `observeChanges` guaranteed not to return\n\t// until the initial set of `added` callbacks have run, so the `count`\n\t// variable is up to date.\n\tself.added(\"liveFeedCounts\", spaceId, {count: liveFeedCounts});\n\n\t// and signal that the initial document set is now available on the client\n\tself.ready();\n\n\t// turn off observe when client unsubscribes\n\tself.onStop(function () {\n\t\thandle.stop();\n\t});\n});\n\n\n\tMeteor.publish(\"count-all-resources\", function (spaceId) {\n\tvar self = this;\n\tvar resourcesCounts = 0;\n\tvar initializing = true;\n\n\tvar handle = Posts.find({spaceId: spaceId, type:'resource'}).observeChanges({\n\t\tadded: function (doc, idx) {\n\t\t\tresourcesCounts++;\n\t\t\tif (!initializing) {\n\t\t\t\tself.changed(\"resourcesCounts\", spaceId, {count: resourcesCounts});  // \"counts\" is the published collection name\n\t\t\t}\n\t\t},\n\t\tremoved: function (doc, idx) {\n\t\t\tresourcesCounts--;\n\t\t\tself.changed(\"resourcesCounts\", spaceId, {count: resourcesCounts});  // Same published collection, \"counts\"\n\t\t}\n\t});\n\n\tinitializing = false;\n\n\t// publish the initial count. `observeChanges` guaranteed not to return\n\t// until the initial set of `added` callbacks have run, so the `count`\n\t// variable is up to date.\n\tself.added(\"resourcesCounts\", spaceId, {count: resourcesCounts});\n\n\t// and signal that the initial document set is now available on the client\n\tself.ready();\n\n\t// turn off observe when client unsubscribes\n\tself.onStop(function () {\n\t\thandle.stop();\n\t});\n});\n}\n\n// if(Meteor.isServer) {\n\n// \tPosts.before.insert(function (userId, doc) {\n// \t\t// change modified date\n// \t\tSpaces.update(doc.spaceId, {$set: {modified: Date.now()}});\n// \t\tdoc.version =  1;\n// \t\t//doc.modified = Date.now();\n// \t\t/*\n// \t\tvar versionning = {};\n// \t\t_.extend(versionning, doc, {modifiedBy: userId});\n// \t\tMeteor.call('addPostVersion', versionning);\n// \t\t*/\n// \t});\n\n\n// \t// Copy post in postVersion before updated\n// \t// TODO : refactoring\n// \tPosts.before.update(function (userId, doc, fieldNames, modifier, options) {\n\n\n\n// \t\t// var versionning = {};\n// \t\t// _.extend(versionning, doc, {modifiedBy: userId});\n// \t\t// Meteor.call('addPostVersion', versionning);\n\n// \t\t// var newInc = doc.version+1;\n// \t\t// if (!modifier.$set) modifier.$set = {};\n// \t\t// modifier.$set.version = newInc;\n// \t\t// modifier.$set.modified = Date.now();\n// \t});\n\n\n// \tPosts.before.remove(function (userId, doc) { \n\n\n// \t\t// var deletionTime = Date.now();\n\n// \t\t// Meteor.call('tagsEdit', {spaceId: doc.spaceId, newTags: [], oldTags: doc.tags}, function(error) { // Decrement tags nRefs\n// \t\t// \tif (error) {\n// \t\t// \t\tthrowError(error.reason);\n// \t\t// \t}\n//  \t// \t});\n\n// \t\t// var file = Files.findOne({'metadata.postId': doc.fileId}); // Remove file\n// \t\t// if (file){\n// \t\t// \t // TODO : remove file (not only from collection)\n// \t\t// \tFiles.remove(file._id);\n// \t\t// }\n\n// \t\t// Delete the file if exists\n// \t\tvar fileId = doc.fileId;\n// \t\tvar fileExt = doc.fileExt;\n// \t\tif (fileId) {\n// \t\t\tFiles.remove({fileId:fileId});\n// \t\t\tMeteor.call('deleteFile',doc);\n// \t\t}\n\n// \t\tif (doc.type == 'home') { // Update post order\n// \t\t\tvar post = doc;\n\n// \t\t\tvar postsDown = Posts.find({spaceId:doc.spaceId, type:'home', order:{$gt:post.order}}).fetch();\n\n// \t\t\tfor (var i=0; i<postsDown.length; i++) {\n// \t\t\t\tconsole.log(\"id : \"+postsDown[i]._id);\n// \t\t\t\tvar currentPost = postsDown[i];\n// \t\t\t\tPosts.update({_id:currentPost._id},{$set:{order:currentPost.order-1}});\n// \t\t\t}\n// \t\t}\n\n// \t\tif (doc.type == 'liveFeed') {\n// \t\t\tvar author = Authors.findOne({spaceId: doc.spaceId, name: doc.author});\n// \t\t\tAuthors.update(author._id, {$inc: {nRefs: -1}}); // Decrement author nRefs\n\n// \t\t\tif (doc.category) {\n// \t\t\t\tvar category = Categories.findOne({spaceId: doc.spaceId, type:\"liveFeed\", name: doc.category});\n// \t\t\t\tif (category)\n// \t\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}}); // Decrement category nRefs\n// \t\t\t}\n// \t\t}\n\n// \t\tif (doc.type == 'resource') {\n// \t\t\tif (doc.category) {\n// \t\t\t\tvar category = Categories.findOne({spaceId: doc.spaceId, type:\"resource\", name: doc.category});\n// \t\t\t\tif (category)\n// \t\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}}); // Decrement category nRefs\n// \t\t\t}\n// \t\t}\n// \t\t// // Add post to posts versions\n// \t\t// // TODO : refactoring\n// \t\t// var space = Spaces.findOne(doc.spaceId);\n// \t\t// // var oldPosts = [];\n// \t\t// // if (space.oldPosts !== undefined) {\n// \t\t// // \toldPosts = space.oldPosts;\n// \t\t// // }\n// \t\t// // oldPosts.push(doc._id);\n// \t\t// //Spaces.update(doc.spaceId, {$set: {oldPosts: oldPosts, modified: Date.now()}});\n// \t\t// Spaces.update(doc.spaceId, {$set: {modified: Date.now()}});\n\n// \t\t// doc.version =  doc.version++;\n// \t\t// doc.modified = Date.now();\n// \t\t// var versionning = {};\n// \t\t// _.extend(versionning, doc, {modifiedBy: userId, last: true});\n// \t\t// Meteor.call('addPostVersion', versionning);\n// \t});\n// }\n\nif(Meteor.isServer) {\n\n\t// Posts.after.insert(function (userId, doc) {\n\t// \tNotifications.insert({spaceId:doc.spaceId, author:doc.author, postId: doc._id});\n\t// });\n\n\tPosts.after.remove(function (userId, doc) { \n\t\t\t\n\t\t\t// Delete the file if exists\n\t\t\tvar fileId = doc.fileId;\n\t\t\tvar fileExt = doc.fileExt;\n\t\t\tif (fileId) {\n\t\t\t\tFiles.remove({fileId:fileId});\n\t\t\t\tMeteor.call('deleteFile',doc);\n\t\t\t}\n\n\t\t\t// Decrease author count\n\t\t\tif (doc.type == 'liveFeed') {\n\t\t\t\tvar author = Authors.findOne({spaceId: doc.spaceId, name: doc.author});\n\t\t\t\tAuthors.update(author._id, {$inc: {nRefs: -1}}); // Decrement author nRefs\n\n\t\t\t\t// Decrease category count\n\t\t\t\tif (doc.categoryId) {\n\t\t\t\t\tvar category = Categories.findOne({_id:doc.categoryId});\n\t\t\t\t\tif (category)\n\t\t\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}});\n\t\t\t\t}\n\t\t\t}\n\n\t\t// Decrease category count\n\t\tif (doc.type == 'resource') {\n\t\t\tif (doc.categoryId) {\n\t\t\t\tvar category = Categories.findOne({_id:doc.categoryId});\n\t\t\t\tif (category)\n\t\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}});\n\t\t\t}\n\t\t}\n\t});\n\n\tPosts.after.insert(function (userId, doc) { \n\n\t\tvar space = Spaces.findOne(doc.spaceId);\n\n\n\n\t\t// Send a notification if an author is tagged\n\t\tvar taggedAuthors = doc.body.match(/<{{\"value\":\"(.*?)\",\"prefix\":\"@\"}}>/g);\n\t\tif (taggedAuthors) {\n\t\t\tfor (let i = 0; i < taggedAuthors.length; i++) {\n\t\t\t\tvar taggedAuthor = taggedAuthors[i].replace(/<{{\"value\":\"(.+)\",\"prefix\":\"@\"}}>/, '$1');\n\t\t\t\tconsole.log(\"author tagged : \"+taggedAuthor);\n\t\t\t\tNotifications.insert({spaceId:space._id, sender:doc.author, receiver:taggedAuthor, type:'tag', submitted:Date.now(), postId: doc._id});\n\t\t\t}\n\t\t}\n\n\n\t\tconsole.log(\"space : \"+space.mailPostNotification);\n\n\t\tif (space.mailPostNotification == true) {\n\n\t\t\tconsole.log(\"userId : \"+userId);\n\n\t\t\tif (space.userId != Meteor.userId()) {\n\n\t\t\tvar spaceOwner = Meteor.users.findOne({_id:space.userId});\n\n\t\t\tconsole.log(\"space Id : \"+spaceOwner);\n\n\t\t\tvar ownerMail = spaceOwner.emails[0].address;\n\n\t\t\tconsole.log(\"on envoie un e-mail de notification Ã  :\"+ownerMail);\n\t\t\tvar mailBody = null;\n\t\t\tif (post.filePath) {\n\t\t        mailBody = '<h3>'+TAPi18n.__(\"post-submit--mail-notification-body\")+'</h3><div style=\"padding:8px:border:solid 1px grey;\"><p><b>'+doc.author+'</b></p><p>'+doc.body+'</p><img style=\"width:150px\" src=\"https://live.beekee.ch/upload'+doc.filePath+'\" /></div><a href=\"https://live.beekee.ch/post/'+doc._id+'\">'+TAPi18n.__(\"post-submit--mail-notification-link\")+'</a>'\n\n\t\t\t} else {\n\t\t        mailBody = '<h3>'+TAPi18n.__(\"post-submit--mail-notification-body\")+'</h3><div style=\"padding:8px:border:solid 1px grey;\"><p><b>'+doc.author+'</b></p><p>'+doc.body+'</p></div><a href=\"https://live.beekee.ch/post/'+doc._id+'\">'+TAPi18n.__(\"post-submit--mail-notification-link\")+'</a>'\n\t\t\t}\n\n\t\t\tMeteor.defer(function() { // Avoid client to wait for callback\n\t\t\t\tMeteor.call('sendEmail', // Send an e-mail to user\n\t\t            ownerMail,\n\t\t            'vincent.widmer@beekee.ch',\n\t\t            TAPi18n.__(\"post-submit--mail-notification-subject\"),\n\t\t\t\t\tmailBody\n\t\t        );\t\n\t\t\t});\n\t       }\n\t     }\n\t});\n\n}\n\n\nMeteor.methods({\n\n\taddLikeComment: function(data) {\n\t\tPosts.update({_id:data.currentPostId,\"comments.id\":data.currentCommentId}, {$push: {\"comments.$.likes\": data.author}});\n\t},\n\tremoveLikeComment: function(data) {\n\t\tPosts.update({_id:data.currentPostId,\"comments.id\":data.currentCommentId}, {$pull: {\"comments.$.likes\": data.author}});\n\t},\n\taddResourceLikeComment: function(data) {\n\t\tResources.update({_id:data.currentPostId,\"comments.id\":data.currentCommentId}, {$push: {\"comments.$.likes\": data.author}});\n\t},\n\tremoveResourceLikeComment: function(data) {\n\t\tResources.update({_id:data.currentPostId,\"comments.id\":data.currentCommentId}, {$pull: {\"comments.$.likes\": data.author}});\n\t},\n\thomePostInsert: function(postAttributes) {\n\t\tcheck(postAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\tpost = _.extend(postAttributes, {\n\t\t\tsubmitted: Date.now(),\n\t\t\torder: Posts.find({spaceId: postAttributes.spaceId, type: postAttributes.type}).count()\n\n\t\t\t//nb: Posts.find({spaceId: postAttributes.spaceId}).count() + 1,\n\t\t\t//pinned : false,\n\t\t});\n\n\t\tvar space = Spaces.findOne(postAttributes.spaceId);\n\t\tpost._id = Posts.insert(post);\t\t\n\t\treturn post._id;\n\t},\n\tpostInsert: function(postAttributes) {\n\t\tcheck(postAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\titem = Authors.findOne({spaceId: postAttributes.spaceId, name: postAttributes.author});\n\t\tAuthors.update(item, {$inc: {nRefs: 1}});\n\t\tpost = _.extend(postAttributes, {\n\t\t\tauthorId: Authors.findOne({spaceId: postAttributes.spaceId, name: postAttributes.author})._id,\n\t\t\tsubmitted: Date.now(),\n\t\t\tnb: Posts.find({spaceId: postAttributes.spaceId}).count() + 1,\n\t\t\torder: Posts.find({spaceId: postAttributes.spaceId, type: postAttributes.type}).count(),\n\t\t\tlikes:[],\n\t\t\tnbLikes:0\n\t\t\t// postFromCloud: postFromCloud // Workaround bug sync\n\t\t});\n\n\t\t// Get client IP address\n\t\tif (Meteor.isServer)\n\t\t\tpost = _.extend(postAttributes, {clientIP: this.connection.clientAddress});\n\n\t\tvar space = Spaces.findOne(postAttributes.spaceId);\n\n\t\tcategory = Categories.findOne({spaceId: postAttributes.spaceId, _id: postAttributes.categoryId}); // Increment category nRefs\n\t\tCategories.update(category, {$inc: {nRefs: 1}});\n\n\t\tpost._id = Posts.insert(post);\t\n\n\t\treturn post._id;\n\t}\n});","import { Mongo } from 'meteor/mongo';\n \n// import { Authors } from './authors.js';\n// import { Spaces } from './spaces.js';\nimport { Categories } from './categories.js';\n// import { Files } from './files.js';\n//import { Notifications } from './notifications.js';\n\nexport const Resources = new Mongo.Collection('resources');\n\n\nResources.allow({\n\tinsert: function() {return true;},\n\n\tremove: function() {return true;},\n\n\tupdate: function() {return true;}\n});\n\n\nif(Meteor.isServer) {\n\n\tMeteor.publish('resource', function(resourceId) {\n\t\tcheck(resourceId, String);\n\t\treturn Resources.find({_id: resourceId});\n\t});\n\n\tMeteor.publish('resources', function(filters) {\n\t\t//return Resources.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\t//console.log(\"filters : \"+filters.categoryId);\n\t\treturn Resources.find(filters, {sort: {submitted:1}});\n\t});\n\n\t\tMeteor.publish('allResources', function(filters) {\n\t\t//return Resources.find({spaceId: spaceId},{sort: {submitted: 1}});\n\t\t//console.log(\"filters : \"+filters.categoryId);\n\t\treturn Resources.find(filters, {sort: {submitted:1}});\n\t});\n\n\n\tResources.after.remove(function (userId, doc) { \n\t\tif (doc.categoryId) {\n\t\t\tvar category = Categories.findOne({_id:doc.categoryId});\n\t\t\tif (category)\n\t\t\t\tCategories.update(category._id, {$inc: {nRefs: -1}});\n\t\t}\n\t});\n}\n\n\nMeteor.methods({\n\n\tresourceInsert: function(resourceAttributes) {\n\t\tcheck(resourceAttributes.spaceId, String);\n\n\t\t//if (Meteor.settings.public)\n\t\t\t//var postFromCloud = !(Meteor.settings.public.isBox === \"true\"); // Set where post is submitted (box or cloud)\n\n\t\tresource = _.extend(resourceAttributes, {\n\t\t\tsubmitted: Date.now(),\n\t\t\torder: Resources.find({spaceId: resourceAttributes.spaceId, categoryId: resourceAttributes.categoryId}).count(),\n\t\t});\n\n\t\tcategory = Categories.findOne({spaceId: resourceAttributes.spaceId, _id: resourceAttributes.categoryId}); // Increment category nRefs\n\t\tCategories.update(category, {$inc: {nRefs: 1}});\n\n\t\tvar space = Resources.findOne(resourceAttributes.spaceId);\n\t\tresource._id = Resources.insert(resource);\n\n\t\treturn resource._id;\n\t}\n});","import { Mongo } from 'meteor/mongo';\n\nimport { Authors } from './authors.js';\nimport { Codes } from './codes.js';\nimport { Posts } from './posts.js';\nimport { Categories } from './categories.js';\nimport { Resources } from './resources.js';\n\n\n\n\n\n\nexport const Spaces = new Mongo.Collection('spaces');\n\n\nSpaces.allow({\n\n\t//update: function(userId, space) { return true},\n\t//remove: function(userId, space) { return true},\n\n\tinsert: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); },\n\n\tupdate: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); },\n\n\tremove: function(userId, space) { return ownsDocument(userId, space) || isAdmin(userId); }\n});\n\n\nif(Meteor.isServer) {\n\n\n\tMeteor.publish('space', function(spaceId) {\n\t\tcheck(spaceId, String);\n\t\treturn Spaces.find({_id: spaceId});\t\n\t});\n\n\tMeteor.publish('allSpaces', function() {\n\treturn Spaces.find({});\n\t});\n\n\tMeteor.publish('allUsers', function() {\n\treturn Meteor.users.find();\n \t});\n\n\tMeteor.publish('publicSpaces', function(userId) {\n\treturn Spaces.find({\"permissions.public\":true});\n\t});\n\n\tMeteor.publish('ownSpaces', function(userId) {\n\t\t//return Spaces.find({userId:userId});\n\t\treturn Spaces.find({$or: [{userId: Meteor.userId()},{ownersId:{$in: [Meteor.userId()]}}]});\n\n\t});\n\n\tMeteor.publish('spacesVisited', function(spacesId) {\n\t\treturn Spaces.find({ \"_id\": { \"$in\": spacesId } });\n\t});\n\t// Spaces.before.update(function (userId, doc, fieldNames, modifier, options) {\n\n\t// \tmodifier.$set = modifier.$set || {};\n\t// \tmodifier.$set.modified = Date.now();\n\n\t// \t// change modified date\n\t// \tdoc.version =  doc.version++;\n\t// \tdoc.modified = Date.now();\n\t// });\n\n\t// Spaces.before.insert(function (userId, doc) {\n\t// \t// change modified date\n\t// \tdoc.submitted =  Date.now();\n\t// });\n\nif(Meteor.isServer) {\n\n\t// Remove every posts when a space is deleted\n\tSpaces.before.remove(function (userId, doc) {\n\n\t\tvar spaceId = doc._id;\n\t\tPosts.remove({spaceId:spaceId});\n\t});\n\n\n\n\tMeteor.methods({\n\n\t\tgetSpaceId: function(spaceCode) {\n\t\t\tif (Spaces.findOne({spaceCode:spaceCode}))\n\t\t\t\treturn Spaces.findOne({spaceCode:spaceCode})._id;\n\t\t\telse\n\t\t\t\treturn null;\n\t\t},\n\t\tupdateCode: function(oldCode, newCode) {\n\t\t\tvar codeId = Codes.findOne({code: oldCode})._id;\n\t\t\tCodes.update(codeId,{code:newCode}, function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(\"Error when changing code : \"+error.message);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log(\"Code has been changed.\");\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tchangeOwner: function(spaceId, newUserId) {\n\t\t\tSpaces.update(spaceId,{$set:{userId:newUserId}}, function(error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.log(\"Error when changing owner : \"+error.message);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log(\"Owner has been changed.\");\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\taddOwner: function(newUserMail, spaceId) {\n\t\t\tvar newUser = Meteor.users.findOne({ \"emails.address\" : newUserMail });\n\t\t\tif (newUser) {\n\t\t\t\tvar newUserId = newUser._id;\n\t\t\t\tif (newUserId) {\n\t\t\t\t\tSpaces.update(spaceId,{$addToSet:{ownersId:newUserId}}, function(error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tconsole.log(\"Error when adding new owner : \"+error.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tconsole.log(\"Owner has been added.\");\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdeleteSpace: function(spaceId) {\n\t\t\tSpaces.remove(spaceId);\n\t\t\t//Posts.remove({spaceId:spaceId},{multi:true});\n\t\t},\n\t\tdeleteSpaces: function(userId) {\n\n\t\t\tSpaces.remove({userId:userId});\n\n\t\t},\n\t\tduplicateSpace: function(originSpaceId, duplicaName, lang) {\n\n\n\n\t\t// var newSpace = {\n\t\t// \ttitle: duplicaName,\n\t\t// \tlang: lang,\n\t\t// \tlessons: true\n\t\t// };\n\n\t\t\tvar prefix = Meteor.settings.public.prefix;\n\t\t\tvar codeLength = 4;\n\n\t\t\t// if (nbOfCodes <= 1000)\n\t\t\t// \tcodeLength = 2;\n\t\t\t// else if (nbOfCodes > 1000 && nbOfCodes <= 100000)\n\t\t\t// \tcodeLength = 3;\n\t\t\t// else if (nbOfCodes > 100000 && nbOfCodes <= 10000000)\n\t\t\t// \tcodeLength = 4;\n\n\t\t\tvar code = prefix + makeCode(codeLength);\n\t\t\twhile (typeof Codes.findOne({code: code}) != 'undefined')\n\t\t\t\tcode = prefix + makeCode(codeLength);\n\n\t\t\tcolors = [\"color-1\", \"color-2\", \"color-3\", \"color-4\", \"color-5\", \"color-6\", \"color-7\", \"color-8\"];\n\t\t\t//colors = [\"cdfe96\",\"afccf8\",\"e5c9aa\",\"fabb2d\",\"fff37e\",\"fcd0e8\",\"d7b0f9\"]\n\t\t\tvar colorPicked = colors[Math.floor(Math.random() * colors.length)];\n\n\t\t\tCodes.insert({code:code, userId:Meteor.userId()});\n\n\t\t\tvar userId = Meteor.userId();\n\n\t\t\tvar spaceToCopy = Spaces.findOne(originSpaceId);\n\n\t\t\tvar space = {\n\t\t\t\ttitle: duplicaName,\n\t\t\t\tlang: lang,\n\t\t\t\tuserId: userId,\n\t\t\t\townersId: ownersId,\n\t\t\t\tspaceCode: code,\n\t\t\t\tsubmitted: new Date(),\n\t\t\t\tvisible: spaceToCopy.visible,\n\t\t\t\tcodePanel: spaceToCopy.codePanel,\n\t\t\t\tcreateUserAllowed: spaceToCopy.createUserAllowed,\n\t\t\t\tinstruction:spaceToCopy.instruction,\n\t\t\t\tliveFeed:spaceToCopy.liveFeed,\n\t\t\t\tlessons:spaceToCopy.lessons,\n\t\t\t\tresources:spaceToCopy.resources,\n\t\t\t\tcolor:colorPicked,\n\t\t\t\tliveFeedComments:spaceToCopy.liveFeedComments,\n\t\t\t\tmailPostNotification: spaceToCopy.mailPostNotification,\n\t\t\t\tmailCommentNotification:spaceToCopy.mailCommentNotification,\n\t\t\t\tpermissions:{public:spaceToCopy.permissions.public, authorList:spaceToCopy.permissions.authorList, liveFeedAddPost:spaceToCopy.permissions.liveFeedAddPost, liveFeedAddPostHome:spaceToCopy.permissions.liveFeedAddPostHome, liveFeedAddCategory:spaceToCopy.permissions.liveFeedAddCategory, liveFeedChangeName: spaceToCopy.permissions.liveFeedChangeName, addResourcesAllowed :spaceToCopy.permissions.addResourcesAllowed, passwordNeeded: spaceToCopy.permissions.passwordNeeded, avatarEnabled:spaceToCopy.permissions.avatarEnabled}\t\t\t\t\n\t\t\t}\n\n\t\t\tvar spaceId = Spaces.insert(space);\n\n\t\t\t// Creating directories\n\t\t\tvar fs = Npm.require('fs');\n\t\t\tvar uploadDir = Meteor.settings.uploadDir;\n\t\t\tvar spaceDir = uploadDir+\"/\"+spaceId\n\n\t\t\t// Creating space directory\n\t\t\tif (!fs.existsSync(spaceDir)){\n    \t\t\tfs.mkdirSync(spaceDir);\n\t\t\t}\n\n\t\t\t// Creating resource directory\n\t\t\tif (!fs.existsSync(spaceDir+\"/resource\")){\n    \t\t\tfs.mkdirSync(spaceDir+\"/resource\");\n\t\t\t}\n\n\t\t\t//space = _.extend({}, space, spaceAttributes)\n\n\t\t\t// Duplicate categories\n\t\t      Categories.find({spaceId:originSpaceId}).forEach(function(item){\n\t\t      \t\tCategories.insert({spaceId: spaceId, type:item.type, name: item.name, color: item.color, subcategoryId: item.subcategoryId, instruction: item.instruction, order: item.order, nRefs: 0});\n\t\t      });\n\n\t\t    // Duplicate ressources\n\n\n\t\t// Meteor.call('duplicateResourcesFolder', originalSpaceId, newSpaceId, function(error, result) {\n\t\t// \tif(error)\n\t\t// \t\tconsole.log(TAPi18n.__('error-message')+error.message); \n\t\t// \telse {\n\t\t// \t\tconsole.log(\"result : \"+result);\n\t\t// \t}     \n\t\t// });\n\t\t\t\t      Resources.find({spaceId:originSpaceId}).forEach(function(item){\n\n\t\t\t\t      \tif (item.fileId) {\n\n\t\t\t\t      \t\tvar newFilePath = uploadDir+\"/\"+spaceId+\"/resource/\"+item.fileName+\".\"+item.fileExt;\n\t\t\t\t      \t\tif (fs.existsSync(uploadDir+\"/\"+originSpaceId+\"/resource/\"+item.fileName+\".\"+item.fileExt)){\n\t\t\t\t\t      \t\tfs.copyFile(uploadDir+\"/\"+originSpaceId+\"/resource/\"+item.fileName+\".\"+item.fileExt, newFilePath, (err) => {\n\t  \t\t\t\t\t\t\t\tif (err) throw err;\n\t  \t\t\t\t\t\t\t\tconsole.log('successfully deleted /tmp/hello');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t      \t\t}\n\t\t\t\t      \t}\n\n\t\t      \tif (item.categoryId)\n\t\t      \t\tvar newCategoryId = Categories.findOne({spaceId:spaceId, name:Categories.findOne(item.categoryId).name})._id;\n\t\t      \tResources.insert({spaceId: spaceId, type:item.type, author: item.author, body: item.body, url: item.url, filePath: \"/\"+spaceId+\"/resource/\"+item.fileName+\".\"+item.fileExt, fileName: item.fileName, fileExt: item.fileExt, title: item.title, youtubeid: item.youtubeid, vimeoid: item.vimeoid, fileId: item.fileId, categoryId: newCategoryId, submitted: item.submitted, order:item.order});\n\t\t      });\n\n\t\t\treturn { _id: spaceId };\n\n\n\n\t\t// Meteor.call('spaceInsert', newSpace, function(error, result) {\n\t\t// \tif(error)\n\t\t// \t\tconsole.log(TAPi18n.__('error-message')+error.message); \n\t\t// \telse {\n\t\t// \t\tconsole.log(\"result : \"+result);\n\t\t// \t}     \n\t\t// });\n\n\n\t\t},\n\t\tspaceInsert: function(spaceAttributes) {\n\n\t\t\tcheck(spaceAttributes, {\n\t\t\t\t\ttitle: String,\n\t\t\t\t\tlang: String\n\t\t\t});\n\n\t\t\t//var nbOfCodes = Codes.find().count();\n\t\t\tvar prefix = Meteor.settings.public.prefix;\n\t\t\tvar codeLength = 4;\n\n\t\t\t// if (nbOfCodes <= 1000)\n\t\t\t// \tcodeLength = 2;\n\t\t\t// else if (nbOfCodes > 1000 && nbOfCodes <= 100000)\n\t\t\t// \tcodeLength = 3;\n\t\t\t// else if (nbOfCodes > 100000 && nbOfCodes <= 10000000)\n\t\t\t// \tcodeLength = 4;\n\n\t\t\tvar code = prefix + makeCode(codeLength);\n\t\t\twhile (typeof Codes.findOne({code: code}) != 'undefined')\n\t\t\t\tcode = prefix + makeCode(codeLength);\n\n\t\t\tcolors = [\"color-1\", \"color-2\", \"color-3\", \"color-4\", \"color-5\", \"color-6\", \"color-7\", \"color-8\"];\n\t\t\t//colors = [\"cdfe96\",\"afccf8\",\"e5c9aa\",\"fabb2d\",\"fff37e\",\"fcd0e8\",\"d7b0f9\"]\n\t\t\tvar colorPicked = colors[Math.floor(Math.random() * colors.length)];\n\n\t\t\tCodes.insert({code:code, userId:Meteor.userId()});\n\n\t\t\tvar userId = Meteor.userId();\n\n\t\t\tvar space = {\n\t\t\t\tuserId: userId,\n\t\t\t\townersId: [],\n\t\t\t\tspaceCode: code,\n\t\t\t\tsubmitted: new Date(),\n\t\t\t\tvisible: true,\n\t\t\t\tcodePanel: true,\n\t\t\t\tcreateUserAllowed:true,\n\t\t\t\tinstruction:\"\",\n\t\t\t\tliveFeed:true,\n\t\t\t\tlessons:false,\n\t\t\t\tresources:true,\n\t\t\t\tcolor:colorPicked,\n\t\t\t\tliveFeedComments:true,\n\t\t\t\tmailPostNotification: false,\n\t\t\t\tmailCommentNotification:false,\n\t\t\t\tpermissions:{public:false, authorList:false, liveFeedAddPost:true, liveFeedAddPostHome:true, liveFeedAddCategory:false, liveFeedChangeName: false, addResourcesAllowed :false, passwordNeeded: false, avatarEnabled:true}\t\t\t\t\n\t\t\t}\n\n\n\t\t\tspace = _.extend({}, space, spaceAttributes)\n\t\t\t\n\n\t\t\t// var space = _.extend(spaceAttributes, {\n\t\t\t// \tuserId: userId,\n\t\t\t// \tspaceCode: code,\n\t\t\t// \tsubmitted: new Date(),\n\t\t\t// \tvisible: true,\n\t\t\t// \tcodePanel: true,\n\t\t\t// \tcreateUserAllowed:true,\n\t\t\t// \tinstruction:\"\",\n\t\t\t// \tliveFeed:true,\n\t\t\t// \tlessons:false,\n\t\t\t// \tresources:true,\n\t\t\t// \tcolor:colorPicked,\n\t\t\t// \tliveFeedComments:true,\n\t\t\t// \tmailPostNotification: false,\n\t\t\t// \tmailCommentNotification:false,\n\t\t\t// \tpermissions:{public:false, authorList:false, liveFeedAddPost:true, liveFeedAddPostHome:true, liveFeedAddCategory:false, liveFeedChangeName: false, addResourcesAllowed :false, passwordNeeded: false, avatarEnabled:true}\n\t\t\t// });\n\n\t\t\tvar spaceId = Spaces.insert(space);\n\n\t\t\t//Meteor.call('authorInsert', 'InvitÃ©', spaceId );\n\n\t\t\t// Insert welcome post\n\t\t\t//if (spaceAttributes.lang == \"fr-FR\" || spaceAttributes.lang == \"fr\")\n\t\t\t//\tPosts.insert({spaceId:spaceId, type:\"home\", categoryId:\"\", color:'#afccf8', order:0, submitted: Date.now(),title: \"Bienvenue dans votre nouvel espace Beekee Live !\", body:\"<p>Beekee Live est l'outil idÃ©al pour soutenir les interactions en temps rÃ©el, pour partager des photos ou des fichiers avec vos Ã©tudiants.</p>\\n<p>Ce message est visible par vos Ã©tudiants : sentez-vous libre de le modifier (ou de le supprimer) pour communiquer avec eux.</p>\"});\n\t\t\t//else\n\t\t\t//\tPosts.insert({spaceId:spaceId, type:\"home\", categoryId:\"\", color:'#afccf8', order:0, submitted: Date.now(),title: \"Welcome to your new Beekee Live space!\", body:\"<p>Beekee Live is ideal for real-time interactions and to share pictures or files with your learners.</p>\\n<p>This message will be visibile for everyone: feel free to edit (or delete ) it according to your needs.</p>\"});\n\n\t\t\treturn { _id: spaceId };\n\t\t}\n\t});\n}\n}\n\nfunction makeCode(length)\n{\n\tvar text = \"\";\n\tvar possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"\n\t//var possible = \"ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789\";\n\n\tfor( var i=0; i < length; i++ )\n\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\t\n\treturn text;\n}","import { Mongo } from 'meteor/mongo';\n\nimport { Authors } from './authors.js';\nimport { Spaces } from './spaces.js';\nimport { Posts } from './posts.js';\n\n// Sharing the same Account collection than beekee-live\nif (Meteor.isServer) {\n\n\t// check that the userId specified is admin\nisAdmin = function(userId) {\n\tconsole.log(\"isadmin\");\n  return Roles.userIsInRole(Meteor.user(), 'admin');\n}\n\n\n// Publish Roles to client\nMeteor.publish(null, function () {\n  if (this.userId) {\n    return Meteor.roleAssignment.find({ 'user._id': this.userId });\n  } else {\n    this.ready()\n  }\n});\n\nMeteor.publish(null, function () {\n\t    return Meteor.roleAssignment.find();\n\n});\n\n\n  Meteor.publish('ownersUsers', function(spaceId) {\n    check(spaceId, String);\n    var spaceOwners = Spaces.findOne(spaceId).ownersId;\n    return Meteor.users.find({_id: {\"$in\": spaceOwners}});\n\n  });\n\n\tMeteor.methods({\n\n  'changeEmail': function(email) {\n      var email = email;\n      check(email, String);\n      var user = Meteor.user();\n      var oldemail = user.emails;\n      var emailReg = /^([\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4})?$/;\n      if (emailReg.test(email)) {\n      if(oldemail != null){\n        Accounts.removeEmail(user._id, user.emails[0].address)\n      }\n      Accounts.addEmail(user._id, email);\n      return email;\n    } else\n    return null\n   },\n   'renameUser': function(userId, oldName, newName) {\n      Spaces.find({userId:userId}).forEach(function(item){\n          console.log(\"space id : \"+item._id);\n          //console.log(\"author ? : \"+Authors.update({spaceId:item._id, userId:userId},{$set:{name:newName}}));\n          Posts.update({spaceId:item._id, author:oldName},{$set:{author:newName}},{multi:true});\n          Authors.remove({spaceId:item._id, userId:userId});\n      });\n   }\n});\n\n\n}\n\n\n\n","import { Spaces } from '../imports/api/spaces.js';\n\n\n// ###  Create admin user at first start  ###\n\nif (Spaces.find().count() === 0) {\n\tif (Meteor.users.find().count() === 0) {\n\n\t\t// Create the admin role\n\t\tRoles.createRole('admin', {unlessExists: true});\n\n\t\tvar adminPassword = Meteor.settings.adminPassword;\n\n\t\tvar users = [\n\t\t\t{username:\"admin\",roles:['admin']},\n\t\t];\n\n\t\t_.each(users, function (user) {\n\t\t\tvar id;\n\t\t\tid = Accounts.createUser({\n\t\t\t\tusername: user.username,\n\t\t\t\temail: \"admin@beekee.ch\",\n\t\t\t\t//password: adminPassword,\n\t\t\t\tpassword: \"admin\",\n\t\t\t\tprofile:{name:\"Admin\"}\n\t\t\t});\n\n\t\t\tif (user.roles.length > 0) {\n\t\t\t\tRoles.addUsersToRoles(id, user.roles);\n\t\t\t}\n\t\t});\n\t}\n}","Meteor.startup(function() {\n\n\n\t// ###  Mail configuration  ###\n\tprocess.env.MAIL_URL = 'smtp://'+Meteor.settings.mailAddress+':'+Meteor.settings.mailPassword+'@'+Meteor.settings.mailServer;          \n\tAccounts.emailTemplates.from = \"Beekee Live <vincent.widmer@beekee.ch>\";\n\n\t// Reset Password mail configuration\n\tAccounts.emailTemplates.resetPassword.text = function (user, url) {\n \t\treturn \"Hi, \\n\\n You recently requested to reset your password for your Beekee Live account.\\n\\n Click the link below to reset it. : \\n\"\n\t\t+ url\n\t\t+ \"\\n\\n If you did not requested a password reset, please ignore this email.\"\n\t\t+ \"\\n\\n Thanks,\"\n\t\t+ \"\\n\\n Beekee Live Team\";\n\t};\n\tAccounts.emailTemplates.resetPassword.subject = function () {\n \t\treturn \"Reset your Beekee Live password\";\n\t};\n\n\tAccounts.urls.resetPassword = function(token) {\n\t\treturn 'http://live.beekee.ch/reset-password/' + token;\n\t};\n});\n\n\nexec = Npm.require('child_process').exec; // No idea what is this ?\ncmd = Meteor.wrapAsync(exec);\n\nMeteor.methods({\n\tsendEmail: function (to, from, subject, text) {\n\t\tcheck([to, from, subject, text], [String]);\n\n\t\t// Let other method calls from the same client start running, without waiting for the email sending to complete.\n\t\tthis.unblock();\n\n\t\tEmail.send({\n\t\t\tto: to,\n\t\t\tfrom: from,\n\t\t\tsubject: subject,\n\t\t\thtml: text\n\t\t});\n\t},\n\t'adminSetNewPassword': function(adminId, userId, newPassword) { // Admin can forcibly change the password for a user\n\t\tif (Roles.userIsInRole(adminId, 'admin')) {\n\t\t\tAccounts.setPassword(userId, newPassword);\n\t\t}\n\t},\n\t'createAccount': function(email, password, profile) {\n\t\tAccounts.createUser({email:email,password:password,profile:profile}); // Callback is not supported on server-side\n\t},\n\t'deleteUser': function(userId) {\n\t\tMeteor.users.remove(userId, function (error, result) {\n\t\t\tif (error) {\n\t\t\t\tconsole.log(\"Error when deleting user : \"+error.message);\n\t\t\t}\n\t\t});\n\t},\n\t'getUsedSpace': function() {\n\t\tvar res;\n\t\tres = cmd(\"df / -h | awk '{print ($3)}' | tail -1\") + \"/ \" + cmd(\"df / -h | awk '{print ($2)}' | tail -1\") + \" (\"+cmd(\"df / | awk '{print ($5)}' | tail -1\")+\"used)\";\n\t\treturn res;\n\t},\n\t'getCpuUsage': function() {\n\t\tvar res;\n\t\tres = cmd(\"ps -A -o pcpu | tail -n+2 | paste -sd+ | bc\");\n\t\treturn res;\n\t},\n\t'getMemoryUsage': function() {\n\t\tvar res;\n\t\tres = cmd(\"free -m | grep Mem | awk '{print ($3/$2)*100}'\");\n\t\treturn res;\n\t},\n\t'isPremium': function(userId) {\n\t\treturn Meteor.users.findOne(userId).profile.premium;\n\t}\n});","// check that the userId specified owns the documents\nownsDocument = function(userId, doc) {\n  return doc && doc.userId === userId || doc.ownersId.indexOf(userId) != -1;\n}\n\n// check that the userId specified is admin\nisAdmin = function(userId) {\n  return Roles.userIsInRole(Meteor.user(), 'admin');\n}","import { Files } from '../imports/api/files.js';\n\n// Upload files with tomitrescak:meteor-uploads\n\n\nMeteor.startup(function () {\n\n\tMeteor.methods({\n\trotateImage: function (imagePath) {\n\t\t\n\t\tgmRotate = function(callback) {\n\t\t\tgm(Meteor.settings.uploadDir+imagePath).rotate('white', 90).write(Meteor.settings.uploadDir+imagePath,Meteor.bindEnvironment(function (error, result){\n\t\t\t\tcallback(null, 'returned');;\n\t\t\t}));\n\t\t}\n\n\t\t// Wait until GraphicMagicks has ended rotating the image\n\t\tvar syncFunc = Meteor.wrapAsync(gmRotate); \n    \tvar result = syncFunc();\n    \treturn result;\n\t}\n});\n\n\tUploadServer.init({\n\t\ttmpDir: Meteor.settings.uploadDir+'/tmp',\n\t\tuploadDir: Meteor.settings.uploadDir,\n\t\tcheckCreateDirectories: true,\n\t\tmaxFileSize: 2e8,\n\t\t  //   validateRequest: function(req) {\n    // \tif (req.headers[\"content-length\"] > 10) {\n    // \t\tconsole.log(\"file too long\");\n    // \t    return \"File is too long!\";\n    // \t}\n    // \treturn null;\n    // },\n\t\tgetDirectory: function(fileInfo, formData) {\n\n\t\t\tvar spaceId = formData.spaceId;\n\t\t\tfileInfo.spaceId = spaceId;\n\n\t\t\tvar newID = new Mongo.ObjectID(); // Manually generate a new Mongo id\n\t\t\tvar fileId = newID._str;\n\t\t\tfileInfo.fileId = fileId;\n\n\t\t\tif (formData.type == 'liveFeed') {\n\t\t\t\tconsole.log(\"Uploading a liveFeed file...\");\n\t\t\t\treturn '/'+spaceId+'/liveFeed/';\n\t\t\t}\n\t\t\telse if (formData.type == 'resource') {\n\t\t\t\tconsole.log(\"Uploading a resource...\");\n\t\t\t\treturn '/'+spaceId+'/resource/';\n\t\t\t}\n\t\t\tif (formData.type == 'assignment') {\n\t\t\t\tconsole.log(\"Uploading a assignment file...\");\n\t\t\t\treturn '/'+spaceId+'/assignment/';\n\t\t\t}\n\t\t\telse if (formData.type == 'lesson') {\n\t\t\t\tconsole.log(\"Uploading lesson file...\");\n\t\t\t\treturn '/'+spaceId+'/lesson/'+fileId;\n\t\t\t}\n\t\t\t// TODO : add more security\n\t\t\telse if (formData.type == 'update') {\n\t\t\t\tconsole.log(\"Uploading update file\");\n\t\t\t\treturn '/updates';\n\t\t\t}\n\t\t\treturn '/';\n\t\t\t\n\t\t},\n\t\tfinished: function(fileInfo, formFields, formData) {\n\n\t\t\tvar fileName = fileInfo.name.substr(0, fileInfo.name.lastIndexOf('.')) || fileInfo.name;\n\t\t\tfileInfo.fileName = fileName;\n\t\t\t//fileInfo.fileName = unescape(fileName); // Check why we unescape file name in getFileName method\n\n\t\t\tvar fileExt = fileInfo.name.substr(fileInfo.name.lastIndexOf('.')+1).toLowerCase();\n\t\t\tfileInfo.fileExt = fileExt;\n\n\t\t\tif (formFields.type == 'liveFeed' || formFields.type == 'resource' || formFields.type == 'assignment') {\n\t\t\t\tif (fileExt == \"jpg\" || fileExt == \"jpeg\" || fileExt == \"png\") {\n\t\t\t\t\t// Resize and auto-orient uploaded images with GraphicMagicks\n\t\t\t\t\tgm(Meteor.settings.uploadDir+fileInfo.path).autoOrient().resize('1200','1200').write(Meteor.settings.uploadDir+fileInfo.path,Meteor.bindEnvironment(function (error, result) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\tconsole.log(\"Error when resizing :\"+error);\n\t\t\t\t\t\t\tvar errorMessage = \"An error has occured.\"\n\t\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, error:errorMessage});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, fileName:fileInfo.fileName, fileExt:fileExt, filePath: fileInfo.path});\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, fileName:fileInfo.fileName, fileExt:fileExt, filePath: fileInfo.path});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (formFields.type == 'lesson') {\n\t\t\t\tcmd = Meteor.wrapAsync(exec);\n\t\t\t\tres = cmd(\"unzip '\"+Meteor.settings.uploadDir+fileInfo.path+\"' -d '\"+Meteor.settings.uploadDir+\"/\"+fileInfo.spaceId+\"/lesson/\"+fileInfo.fileId+\"'\", {maxBuffer : 1024 * 1024 * 64}, function(error,result){\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.log(\"Error when uploading a lesson : \"+error);\n\t\t\t\t\t\tvar errorMessage = \"An error has occured.\"\n\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, error:errorMessage});\n\t\t\t\t\t} else {\t\t\t\t\n\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, fileName:fileInfo.fileName, fileExt:fileExt, filePath: fileInfo.path})\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tres2 = cmd(\"rm '\"+Meteor.settings.uploadDir+fileInfo.path+\"'\");\n\t\t\t}\n\t\t\telse if (formFields.type == 'update') {\n\t\t\t\tcmd = Meteor.wrapAsync(exec);\t\n\t\t\t\tres = cmd(\"tar zxvf '\"+Meteor.settings.uploadDir+fileInfo.path+\"' -C \"+Meteor.settings.updateDir, {maxBuffer : 1024 * 1024 * 64}, function(error,result){\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tconsole.log(\"Error when uploading an update : \"+error);\n\t\t\t\t\t\tvar errorMessage = \"An error has occured.\"\n\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, error:errorMessage});\n\t\t\t\t\t} else {\t\t\t\t\n\t\t\t\t\t\tFiles.insert({_id: fileInfo.fileId, fileName:fileInfo.fileName, fileExt:fileExt, filePath: fileInfo.path})\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tres2 = cmd(\"rm '\"+Meteor.settings.uploadDir+fileInfo.path+\"'\", {maxBuffer : 1024 * 1024 * 64},);\n\t\t\t}\n\t\t},\n\t\tgetFileName: function(fileInfo, formFields, formData) { \n\n\t\t\tvar fileName = fileInfo.name;\t\n\n\t\t\t//fileName = escape(fileName);\n\t\t\t// The file name is used to generate the file path, so we escape unicode characters\n\t\t\t// and then we unescape it in finished method to save it in human-readable text\n\n\t\t\treturn fileName;\n\t\t\t// var fileExt = fileInfo.name.substr(fileInfo.name.lastIndexOf('.')+1).toLowerCase();\n\n\t\t\t// // If file is an image, set a random name\n\t\t\t// if (fileExt == \"jpg\" || fileExt == \"jpeg\" || fileExt == \"png\") {\n\t\t\t// \tvar newName = Random.id() + '.' + fileExt;\n\t\t\t// \treturn newName;\n\t\t\t// }\n\t\t\t// else {\n\t\t\t// \tvar fileName = fileInfo.name;\t\n\n\t\t\t// \tfileName = encodeURIComponent(fileName);\n\n\t\t\t// \treturn fileName;\n\t\t\t// }\n\t\t},\n\t\tcacheTime: 0,\n  \t});\n});","import { Meteor } from 'meteor/meteor';\nimport { Authors } from '../imports/api/authors.js';\n\n\nimport '../server/fixtures.js';\nimport '../server/methods.js';\n\n//import '../server/publications.js';\nimport '../server/uploads.js';\nimport '../server/permissions.js';\nimport '../lib/app_loader.js';\nimport '../imports/api/users.js';\n\nimport '../imports/api/spaces.js';\nimport '../imports/api/authors.js';\nimport '../imports/api/codes.js';\nimport '../imports/api/files.js';\nimport '../imports/api/posts.js';\nimport '../imports/api/chats.js';\nimport '../imports/api/resources.js';\nimport '../imports/api/activities.js';\nimport '../imports/api/assignments.js';\nimport '../imports/api/notifications.js';\n\n//import { Posts } from '../imports/api/posts.js';\n//import { Categories } from '../imports/api/categories.js';\n//import { Authors } from '../imports/api/authors.js';\n\nMeteor.startup(() => {\n\n\n\t\t// colors = [\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\",\"27a498\",\"25c0d4\",\"27b0ee\",\"41a1ef\",\"5a66ba\",\"7d58bf\",\"a345b7\",\"e73f78\",\"ec5b51\",\"f86c41\",\"f8a126\",\"f7c42b\",\"f7e657\",\"ceda55\",\"97c561\",\"63b668\"];\n\t\n\t\t// Authors.find().forEach(function(item){\n\t\t// \tcolorPicked = \"#\"+colors[Math.floor(Math.random() * colors.length)];\n\t\t// \tAuthors.update({_id:item._id},{$set:{color:colorPicked}});\n\t\t// });\n\n\t// Update category -> categoryId\n// \tPosts.find().forEach(function(item){\n// \t\t//Post.update({item._id},{$set:{categoryId:Categories.find({spaceId:item.spaceId,name:item.category})._id},{multi:true});\n// \t\tif (item.category) {\n// \t\tif (Categories.findOne({spaceId:item.spaceId,name:item.category})) {\n// \t\t\tPosts.update({_id:item._id,category:{$exists:true}},{$set:{categoryId:Categories.findOne({spaceId:item.spaceId,name:item.category})._id}});\n// \t\t}\n// \t}\n// });\n\n\n\t// Update nbLikes\n// \tPosts.find().forEach(function(item){\n// \t\t//Post.update({item._id},{$set:{categoryId:Categories.find({spaceId:item.spaceId,name:item.category})._id},{multi:true});\n\n// \t\tif (item.type == \"liveFeed\" && !item.likes)\n// \t\t\tPosts.update({_id:item._id},{$set:{likes:[]}});\n// \t\tif (item.likes)\n// \t\t\tPosts.update({_id:item._id},{$set:{nbLikes:item.likes.length}});\n// });\n\n\n  // code to run on server at startup\n\n\t// Connect Accounts to remote App\n\t//Meteor.connection = DDP.connect('http://beekee.box:80');\n\t// Remote = DDP.connect('http://beekee.box:80');\n\t// Accounts.connection = Remote;\n\t// Meteor.users = new Mongo.Collection('users', Remote);\n\t//  Accounts.connection.subscribe('users');\n// __meteor_runtime_config__.ACCOUNTS_CONNECTION_URL = 'http://beekee.box:80';\n\n// var connection = DDP.connect(\"http://beekee.box:80\");\n// Accounts.connection = connection;\n// Meteor.users = new Mongo.Collection(\"users\", {connection: connection});\n\n\t// Update avatars\n\t// avatars = [\"avatar-1\", \"avatar-2\",\"avatar-3\", \"avatar-4\",\"avatar-5\", \"avatar-6\",\"avatar-7\", \"avatar-8\",\"avatar-9\", \"avatar-10\",\"avatar-11\", \"avatar-12\",\"avatar-13\", \"avatar-14\",\"avatar-15\", \"avatar-16\",\"avatar-17\", \"avatar-18\",\"avatar-19\", \"avatar-20\",\"avatar-21\", \"avatar-22\",\"avatar-23\", \"avatar-24\", \"avatar-25\"];\n\t\n\t// Authors.find({avatar:{$exists:false}}).forEach(function(item){\n\t// \tavatarPicked = avatars[Math.floor(Math.random() * avatars.length)];\n\t// \tAuthors.update({_id:item._id},{$set:{avatar:avatarPicked}});\n\t// });\n\n\t// Meteor.users.update({\"profile.avatar\":{$exists:false}},{$set:{\"profile.avatar\":\"avatar-1\"}});\n\t// Meteor.users.update({\"profile.color\":{$exists:false}},{$set:{\"profile.color\":\"#7d58bf\"}});\n\n\t// Authors.find().forEach(function(item){\n\t// \tif (Meteor.users.findOne(item.userId)) {\n\t// \t\tconsole.log(\"user : \"+item.userId);\n\t// \t\tif (Meteor.users.findOne(item.userId).profile) {\n\t// \t\t\tvar avatar = Meteor.users.findOne(item.userId).profile.avatar;\n\t// \t\t\tvar color = Meteor.users.findOne(item.userId).profile.color;\n\t// \t\t\tconsole.log(\"avatar : \"+avatar);\n\t// \t\t\tAuthors.update({userId:item.userId},{$set:{avatar:avatar, color:color}});\n\t// \t\t}\n\t// \t}\n\t// });\n\n\n});\n"]}